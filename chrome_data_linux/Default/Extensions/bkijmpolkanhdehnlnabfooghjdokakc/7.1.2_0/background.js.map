{"version":3,"sources":["../lib/functions.ts","../lib/index.ts","browser-polyfill.js","../node_modules/webextension-polyfill-ts/lib/index.js","common/messages.ts","../src/index.ts","../src/utils.ts","../src/comparator.ts","common/filtering.ts","common/settings/validation.ts","common/settings/enums.ts","common/settings/io.ts","common/settings/settings.ts","common/settings/monitoring.ts","common/compatibility.ts","background/state.ts","background/notifications.ts","common/filename.ts","background/downloads.ts","background/context-menu.ts","background/messaging.ts","background/settings-validation.ts","background/hotkey.ts","background.ts"],"names":["browser","Object","getPrototypeOf","prototype","CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE","SEND_RESPONSE_DEPRECATION_WARNING","wrapAPIs","extensionAPIs","apiMetadata","keys","length","Error","DefaultWeakMap","WeakMap","constructor","createItem","items","get","key","has","set","isThenable","makeCallback","promise","metadata","callbackArgs","runtime","lastError","reject","message","singleCallbackArg","resolve","pluralizeArguments","numArgs","wrapMethod","target","method","wrapper","Proxy","apply","targetMethod","thisObj","args","call","hasOwnProperty","Function","bind","wrapObject","wrappers","cache","create","handlers","proxyTarget","prop","receiver","undefined","value","name","minArgs","maxArgs","Promise","fallbackToNoCallback","cbError","console","warn","noCallback","wrapAsyncFunction","defineProperty","configurable","enumerable","desc","Reflect","deleteProperty","wrapEvent","wrapperMap","addListener","listener","hasListener","removeListener","onRequestFinishedWrappers","req","wrappedReq","getContent","loggedSendResponseDeprecationWarning","onMessageWrappers","sender","sendResponse","didCallSendResponse","wrappedSendResponse","result","sendResponsePromise","response","stack","err","isResultThenable","then","sendPromisedResult","msg","error","__mozWebExtensionPolyfillReject__","catch","wrappedSendMessage","apiNamespaceObj","wrappedCb","reply","push","sendMessage","staticWrappers","devtools","network","onRequestFinished","onMessage","onMessageExternal","tabs","settingMetadata","clear","privacy","services","websites","chrome","id","module","exports"],"mappings":"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","file":"background.js","sourceRoot":"..\\src","sourcesContent":[null,null,"/* webextension-polyfill - v0.8.0 - Tue Apr 20 2021 11:27:38 */\n/* -*- Mode: indent-tabs-mode: nil; js-indent-level: 2 -*- */\n/* vim: set sts=2 sw=2 et tw=80: */\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nif (typeof browser === \"undefined\" || Object.getPrototypeOf(browser) !== Object.prototype) {\n  const CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE = \"The message port closed before a response was received.\";\n  const SEND_RESPONSE_DEPRECATION_WARNING = \"Returning a Promise is the preferred way to send a reply from an onMessage/onMessageExternal listener, as the sendResponse will be removed from the specs (See https://developer.mozilla.org/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage)\";\n\n  // Wrapping the bulk of this polyfill in a one-time-use function is a minor\n  // optimization for Firefox. Since Spidermonkey does not fully parse the\n  // contents of a function until the first time it's called, and since it will\n  // never actually need to be called, this allows the polyfill to be included\n  // in Firefox nearly for free.\n  const wrapAPIs = extensionAPIs => {\n    // NOTE: apiMetadata is associated to the content of the api-metadata.json file\n    // at build time by replacing the following \"include\" with the content of the\n    // JSON file.\n    const apiMetadata = {\n      \"alarms\": {\n        \"clear\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"clearAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"get\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"bookmarks\": {\n        \"create\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getChildren\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getRecent\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getSubTree\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getTree\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"move\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeTree\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"search\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      },\n      \"browserAction\": {\n        \"disable\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"enable\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"getBadgeBackgroundColor\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getBadgeText\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"openPopup\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"setBadgeBackgroundColor\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setBadgeText\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setIcon\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"setPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        }\n      },\n      \"browsingData\": {\n        \"remove\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"removeCache\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeCookies\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeDownloads\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeFormData\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeHistory\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeLocalStorage\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removePasswords\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removePluginData\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"settings\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"commands\": {\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"contextMenus\": {\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      },\n      \"cookies\": {\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAllCookieStores\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"set\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"devtools\": {\n        \"inspectedWindow\": {\n          \"eval\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 2,\n            \"singleCallbackArg\": false\n          }\n        },\n        \"panels\": {\n          \"create\": {\n            \"minArgs\": 3,\n            \"maxArgs\": 3,\n            \"singleCallbackArg\": true\n          },\n          \"elements\": {\n            \"createSidebarPane\": {\n              \"minArgs\": 1,\n              \"maxArgs\": 1\n            }\n          }\n        }\n      },\n      \"downloads\": {\n        \"cancel\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"download\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"erase\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getFileIcon\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"open\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"pause\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeFile\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"resume\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"search\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"show\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        }\n      },\n      \"extension\": {\n        \"isAllowedFileSchemeAccess\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"isAllowedIncognitoAccess\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"history\": {\n        \"addUrl\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"deleteAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"deleteRange\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"deleteUrl\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getVisits\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"search\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"i18n\": {\n        \"detectLanguage\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAcceptLanguages\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"identity\": {\n        \"launchWebAuthFlow\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"idle\": {\n        \"queryState\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"management\": {\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getSelf\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"setEnabled\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"uninstallSelf\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        }\n      },\n      \"notifications\": {\n        \"clear\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"create\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getPermissionLevel\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      },\n      \"pageAction\": {\n        \"getPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"hide\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setIcon\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"setPopup\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"setTitle\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        },\n        \"show\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1,\n          \"fallbackToNoCallback\": true\n        }\n      },\n      \"permissions\": {\n        \"contains\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"request\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"runtime\": {\n        \"getBackgroundPage\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getPlatformInfo\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"openOptionsPage\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"requestUpdateCheck\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"sendMessage\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 3\n        },\n        \"sendNativeMessage\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"setUninstallURL\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"sessions\": {\n        \"getDevices\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getRecentlyClosed\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"restore\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        }\n      },\n      \"storage\": {\n        \"local\": {\n          \"clear\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getBytesInUse\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"set\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        },\n        \"managed\": {\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getBytesInUse\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          }\n        },\n        \"sync\": {\n          \"clear\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 0\n          },\n          \"get\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"getBytesInUse\": {\n            \"minArgs\": 0,\n            \"maxArgs\": 1\n          },\n          \"remove\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          },\n          \"set\": {\n            \"minArgs\": 1,\n            \"maxArgs\": 1\n          }\n        }\n      },\n      \"tabs\": {\n        \"captureVisibleTab\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 2\n        },\n        \"create\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"detectLanguage\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"discard\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"duplicate\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"executeScript\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getCurrent\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        },\n        \"getZoom\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getZoomSettings\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"goBack\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"goForward\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"highlight\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"insertCSS\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"move\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        },\n        \"query\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"reload\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 2\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"removeCSS\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"sendMessage\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 3\n        },\n        \"setZoom\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"setZoomSettings\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"update\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        }\n      },\n      \"topSites\": {\n        \"get\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"webNavigation\": {\n        \"getAllFrames\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"getFrame\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        }\n      },\n      \"webRequest\": {\n        \"handlerBehaviorChanged\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 0\n        }\n      },\n      \"windows\": {\n        \"create\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"get\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 2\n        },\n        \"getAll\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getCurrent\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"getLastFocused\": {\n          \"minArgs\": 0,\n          \"maxArgs\": 1\n        },\n        \"remove\": {\n          \"minArgs\": 1,\n          \"maxArgs\": 1\n        },\n        \"update\": {\n          \"minArgs\": 2,\n          \"maxArgs\": 2\n        }\n      }\n    };\n\n    if (Object.keys(apiMetadata).length === 0) {\n      throw new Error(\"api-metadata.json has not been included in browser-polyfill\");\n    }\n\n    /**\n     * A WeakMap subclass which creates and stores a value for any key which does\n     * not exist when accessed, but behaves exactly as an ordinary WeakMap\n     * otherwise.\n     *\n     * @param {function} createItem\n     *        A function which will be called in order to create the value for any\n     *        key which does not exist, the first time it is accessed. The\n     *        function receives, as its only argument, the key being created.\n     */\n    class DefaultWeakMap extends WeakMap {\n      constructor(createItem, items = undefined) {\n        super(items);\n        this.createItem = createItem;\n      }\n\n      get(key) {\n        if (!this.has(key)) {\n          this.set(key, this.createItem(key));\n        }\n\n        return super.get(key);\n      }\n    }\n\n    /**\n     * Returns true if the given object is an object with a `then` method, and can\n     * therefore be assumed to behave as a Promise.\n     *\n     * @param {*} value The value to test.\n     * @returns {boolean} True if the value is thenable.\n     */\n    const isThenable = value => {\n      return value && typeof value === \"object\" && typeof value.then === \"function\";\n    };\n\n    /**\n     * Creates and returns a function which, when called, will resolve or reject\n     * the given promise based on how it is called:\n     *\n     * - If, when called, `chrome.runtime.lastError` contains a non-null object,\n     *   the promise is rejected with that value.\n     * - If the function is called with exactly one argument, the promise is\n     *   resolved to that value.\n     * - Otherwise, the promise is resolved to an array containing all of the\n     *   function's arguments.\n     *\n     * @param {object} promise\n     *        An object containing the resolution and rejection functions of a\n     *        promise.\n     * @param {function} promise.resolve\n     *        The promise's resolution function.\n     * @param {function} promise.reject\n     *        The promise's rejection function.\n     * @param {object} metadata\n     *        Metadata about the wrapped method which has created the callback.\n     * @param {boolean} metadata.singleCallbackArg\n     *        Whether or not the promise is resolved with only the first\n     *        argument of the callback, alternatively an array of all the\n     *        callback arguments is resolved. By default, if the callback\n     *        function is invoked with only a single argument, that will be\n     *        resolved to the promise, while all arguments will be resolved as\n     *        an array if multiple are given.\n     *\n     * @returns {function}\n     *        The generated callback function.\n     */\n    const makeCallback = (promise, metadata) => {\n      return (...callbackArgs) => {\n        if (extensionAPIs.runtime.lastError) {\n          promise.reject(new Error(extensionAPIs.runtime.lastError.message));\n        } else if (metadata.singleCallbackArg ||\n                   (callbackArgs.length <= 1 && metadata.singleCallbackArg !== false)) {\n          promise.resolve(callbackArgs[0]);\n        } else {\n          promise.resolve(callbackArgs);\n        }\n      };\n    };\n\n    const pluralizeArguments = (numArgs) => numArgs == 1 ? \"argument\" : \"arguments\";\n\n    /**\n     * Creates a wrapper function for a method with the given name and metadata.\n     *\n     * @param {string} name\n     *        The name of the method which is being wrapped.\n     * @param {object} metadata\n     *        Metadata about the method being wrapped.\n     * @param {integer} metadata.minArgs\n     *        The minimum number of arguments which must be passed to the\n     *        function. If called with fewer than this number of arguments, the\n     *        wrapper will raise an exception.\n     * @param {integer} metadata.maxArgs\n     *        The maximum number of arguments which may be passed to the\n     *        function. If called with more than this number of arguments, the\n     *        wrapper will raise an exception.\n     * @param {boolean} metadata.singleCallbackArg\n     *        Whether or not the promise is resolved with only the first\n     *        argument of the callback, alternatively an array of all the\n     *        callback arguments is resolved. By default, if the callback\n     *        function is invoked with only a single argument, that will be\n     *        resolved to the promise, while all arguments will be resolved as\n     *        an array if multiple are given.\n     *\n     * @returns {function(object, ...*)}\n     *       The generated wrapper function.\n     */\n    const wrapAsyncFunction = (name, metadata) => {\n      return function asyncFunctionWrapper(target, ...args) {\n        if (args.length < metadata.minArgs) {\n          throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);\n        }\n\n        if (args.length > metadata.maxArgs) {\n          throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);\n        }\n\n        return new Promise((resolve, reject) => {\n          if (metadata.fallbackToNoCallback) {\n            // This API method has currently no callback on Chrome, but it return a promise on Firefox,\n            // and so the polyfill will try to call it with a callback first, and it will fallback\n            // to not passing the callback if the first call fails.\n            try {\n              target[name](...args, makeCallback({resolve, reject}, metadata));\n            } catch (cbError) {\n              console.warn(`${name} API method doesn't seem to support the callback parameter, ` +\n                           \"falling back to call it without a callback: \", cbError);\n\n              target[name](...args);\n\n              // Update the API method metadata, so that the next API calls will not try to\n              // use the unsupported callback anymore.\n              metadata.fallbackToNoCallback = false;\n              metadata.noCallback = true;\n\n              resolve();\n            }\n          } else if (metadata.noCallback) {\n            target[name](...args);\n            resolve();\n          } else {\n            target[name](...args, makeCallback({resolve, reject}, metadata));\n          }\n        });\n      };\n    };\n\n    /**\n     * Wraps an existing method of the target object, so that calls to it are\n     * intercepted by the given wrapper function. The wrapper function receives,\n     * as its first argument, the original `target` object, followed by each of\n     * the arguments passed to the original method.\n     *\n     * @param {object} target\n     *        The original target object that the wrapped method belongs to.\n     * @param {function} method\n     *        The method being wrapped. This is used as the target of the Proxy\n     *        object which is created to wrap the method.\n     * @param {function} wrapper\n     *        The wrapper function which is called in place of a direct invocation\n     *        of the wrapped method.\n     *\n     * @returns {Proxy<function>}\n     *        A Proxy object for the given method, which invokes the given wrapper\n     *        method in its place.\n     */\n    const wrapMethod = (target, method, wrapper) => {\n      return new Proxy(method, {\n        apply(targetMethod, thisObj, args) {\n          return wrapper.call(thisObj, target, ...args);\n        },\n      });\n    };\n\n    let hasOwnProperty = Function.call.bind(Object.prototype.hasOwnProperty);\n\n    /**\n     * Wraps an object in a Proxy which intercepts and wraps certain methods\n     * based on the given `wrappers` and `metadata` objects.\n     *\n     * @param {object} target\n     *        The target object to wrap.\n     *\n     * @param {object} [wrappers = {}]\n     *        An object tree containing wrapper functions for special cases. Any\n     *        function present in this object tree is called in place of the\n     *        method in the same location in the `target` object tree. These\n     *        wrapper methods are invoked as described in {@see wrapMethod}.\n     *\n     * @param {object} [metadata = {}]\n     *        An object tree containing metadata used to automatically generate\n     *        Promise-based wrapper functions for asynchronous. Any function in\n     *        the `target` object tree which has a corresponding metadata object\n     *        in the same location in the `metadata` tree is replaced with an\n     *        automatically-generated wrapper function, as described in\n     *        {@see wrapAsyncFunction}\n     *\n     * @returns {Proxy<object>}\n     */\n    const wrapObject = (target, wrappers = {}, metadata = {}) => {\n      let cache = Object.create(null);\n      let handlers = {\n        has(proxyTarget, prop) {\n          return prop in target || prop in cache;\n        },\n\n        get(proxyTarget, prop, receiver) {\n          if (prop in cache) {\n            return cache[prop];\n          }\n\n          if (!(prop in target)) {\n            return undefined;\n          }\n\n          let value = target[prop];\n\n          if (typeof value === \"function\") {\n            // This is a method on the underlying object. Check if we need to do\n            // any wrapping.\n\n            if (typeof wrappers[prop] === \"function\") {\n              // We have a special-case wrapper for this method.\n              value = wrapMethod(target, target[prop], wrappers[prop]);\n            } else if (hasOwnProperty(metadata, prop)) {\n              // This is an async method that we have metadata for. Create a\n              // Promise wrapper for it.\n              let wrapper = wrapAsyncFunction(prop, metadata[prop]);\n              value = wrapMethod(target, target[prop], wrapper);\n            } else {\n              // This is a method that we don't know or care about. Return the\n              // original method, bound to the underlying object.\n              value = value.bind(target);\n            }\n          } else if (typeof value === \"object\" && value !== null &&\n                     (hasOwnProperty(wrappers, prop) ||\n                      hasOwnProperty(metadata, prop))) {\n            // This is an object that we need to do some wrapping for the children\n            // of. Create a sub-object wrapper for it with the appropriate child\n            // metadata.\n            value = wrapObject(value, wrappers[prop], metadata[prop]);\n          } else if (hasOwnProperty(metadata, \"*\")) {\n            // Wrap all properties in * namespace.\n            value = wrapObject(value, wrappers[prop], metadata[\"*\"]);\n          } else {\n            // We don't need to do any wrapping for this property,\n            // so just forward all access to the underlying object.\n            Object.defineProperty(cache, prop, {\n              configurable: true,\n              enumerable: true,\n              get() {\n                return target[prop];\n              },\n              set(value) {\n                target[prop] = value;\n              },\n            });\n\n            return value;\n          }\n\n          cache[prop] = value;\n          return value;\n        },\n\n        set(proxyTarget, prop, value, receiver) {\n          if (prop in cache) {\n            cache[prop] = value;\n          } else {\n            target[prop] = value;\n          }\n          return true;\n        },\n\n        defineProperty(proxyTarget, prop, desc) {\n          return Reflect.defineProperty(cache, prop, desc);\n        },\n\n        deleteProperty(proxyTarget, prop) {\n          return Reflect.deleteProperty(cache, prop);\n        },\n      };\n\n      // Per contract of the Proxy API, the \"get\" proxy handler must return the\n      // original value of the target if that value is declared read-only and\n      // non-configurable. For this reason, we create an object with the\n      // prototype set to `target` instead of using `target` directly.\n      // Otherwise we cannot return a custom object for APIs that\n      // are declared read-only and non-configurable, such as `chrome.devtools`.\n      //\n      // The proxy handlers themselves will still use the original `target`\n      // instead of the `proxyTarget`, so that the methods and properties are\n      // dereferenced via the original targets.\n      let proxyTarget = Object.create(target);\n      return new Proxy(proxyTarget, handlers);\n    };\n\n    /**\n     * Creates a set of wrapper functions for an event object, which handles\n     * wrapping of listener functions that those messages are passed.\n     *\n     * A single wrapper is created for each listener function, and stored in a\n     * map. Subsequent calls to `addListener`, `hasListener`, or `removeListener`\n     * retrieve the original wrapper, so that  attempts to remove a\n     * previously-added listener work as expected.\n     *\n     * @param {DefaultWeakMap<function, function>} wrapperMap\n     *        A DefaultWeakMap object which will create the appropriate wrapper\n     *        for a given listener function when one does not exist, and retrieve\n     *        an existing one when it does.\n     *\n     * @returns {object}\n     */\n    const wrapEvent = wrapperMap => ({\n      addListener(target, listener, ...args) {\n        target.addListener(wrapperMap.get(listener), ...args);\n      },\n\n      hasListener(target, listener) {\n        return target.hasListener(wrapperMap.get(listener));\n      },\n\n      removeListener(target, listener) {\n        target.removeListener(wrapperMap.get(listener));\n      },\n    });\n\n    const onRequestFinishedWrappers = new DefaultWeakMap(listener => {\n      if (typeof listener !== \"function\") {\n        return listener;\n      }\n\n      /**\n       * Wraps an onRequestFinished listener function so that it will return a\n       * `getContent()` property which returns a `Promise` rather than using a\n       * callback API.\n       *\n       * @param {object} req\n       *        The HAR entry object representing the network request.\n       */\n      return function onRequestFinished(req) {\n        const wrappedReq = wrapObject(req, {} /* wrappers */, {\n          getContent: {\n            minArgs: 0,\n            maxArgs: 0,\n          },\n        });\n        listener(wrappedReq);\n      };\n    });\n\n    // Keep track if the deprecation warning has been logged at least once.\n    let loggedSendResponseDeprecationWarning = false;\n\n    const onMessageWrappers = new DefaultWeakMap(listener => {\n      if (typeof listener !== \"function\") {\n        return listener;\n      }\n\n      /**\n       * Wraps a message listener function so that it may send responses based on\n       * its return value, rather than by returning a sentinel value and calling a\n       * callback. If the listener function returns a Promise, the response is\n       * sent when the promise either resolves or rejects.\n       *\n       * @param {*} message\n       *        The message sent by the other end of the channel.\n       * @param {object} sender\n       *        Details about the sender of the message.\n       * @param {function(*)} sendResponse\n       *        A callback which, when called with an arbitrary argument, sends\n       *        that value as a response.\n       * @returns {boolean}\n       *        True if the wrapped listener returned a Promise, which will later\n       *        yield a response. False otherwise.\n       */\n      return function onMessage(message, sender, sendResponse) {\n        let didCallSendResponse = false;\n\n        let wrappedSendResponse;\n        let sendResponsePromise = new Promise(resolve => {\n          wrappedSendResponse = function(response) {\n            if (!loggedSendResponseDeprecationWarning) {\n              console.warn(SEND_RESPONSE_DEPRECATION_WARNING, new Error().stack);\n              loggedSendResponseDeprecationWarning = true;\n            }\n            didCallSendResponse = true;\n            resolve(response);\n          };\n        });\n\n        let result;\n        try {\n          result = listener(message, sender, wrappedSendResponse);\n        } catch (err) {\n          result = Promise.reject(err);\n        }\n\n        const isResultThenable = result !== true && isThenable(result);\n\n        // If the listener didn't returned true or a Promise, or called\n        // wrappedSendResponse synchronously, we can exit earlier\n        // because there will be no response sent from this listener.\n        if (result !== true && !isResultThenable && !didCallSendResponse) {\n          return false;\n        }\n\n        // A small helper to send the message if the promise resolves\n        // and an error if the promise rejects (a wrapped sendMessage has\n        // to translate the message into a resolved promise or a rejected\n        // promise).\n        const sendPromisedResult = (promise) => {\n          promise.then(msg => {\n            // send the message value.\n            sendResponse(msg);\n          }, error => {\n            // Send a JSON representation of the error if the rejected value\n            // is an instance of error, or the object itself otherwise.\n            let message;\n            if (error && (error instanceof Error ||\n                typeof error.message === \"string\")) {\n              message = error.message;\n            } else {\n              message = \"An unexpected error occurred\";\n            }\n\n            sendResponse({\n              __mozWebExtensionPolyfillReject__: true,\n              message,\n            });\n          }).catch(err => {\n            // Print an error on the console if unable to send the response.\n            console.error(\"Failed to send onMessage rejected reply\", err);\n          });\n        };\n\n        // If the listener returned a Promise, send the resolved value as a\n        // result, otherwise wait the promise related to the wrappedSendResponse\n        // callback to resolve and send it as a response.\n        if (isResultThenable) {\n          sendPromisedResult(result);\n        } else {\n          sendPromisedResult(sendResponsePromise);\n        }\n\n        // Let Chrome know that the listener is replying.\n        return true;\n      };\n    });\n\n    const wrappedSendMessageCallback = ({reject, resolve}, reply) => {\n      if (extensionAPIs.runtime.lastError) {\n        // Detect when none of the listeners replied to the sendMessage call and resolve\n        // the promise to undefined as in Firefox.\n        // See https://github.com/mozilla/webextension-polyfill/issues/130\n        if (extensionAPIs.runtime.lastError.message === CHROME_SEND_MESSAGE_CALLBACK_NO_RESPONSE_MESSAGE) {\n          resolve();\n        } else {\n          reject(new Error(extensionAPIs.runtime.lastError.message));\n        }\n      } else if (reply && reply.__mozWebExtensionPolyfillReject__) {\n        // Convert back the JSON representation of the error into\n        // an Error instance.\n        reject(new Error(reply.message));\n      } else {\n        resolve(reply);\n      }\n    };\n\n    const wrappedSendMessage = (name, metadata, apiNamespaceObj, ...args) => {\n      if (args.length < metadata.minArgs) {\n        throw new Error(`Expected at least ${metadata.minArgs} ${pluralizeArguments(metadata.minArgs)} for ${name}(), got ${args.length}`);\n      }\n\n      if (args.length > metadata.maxArgs) {\n        throw new Error(`Expected at most ${metadata.maxArgs} ${pluralizeArguments(metadata.maxArgs)} for ${name}(), got ${args.length}`);\n      }\n\n      return new Promise((resolve, reject) => {\n        const wrappedCb = wrappedSendMessageCallback.bind(null, {resolve, reject});\n        args.push(wrappedCb);\n        apiNamespaceObj.sendMessage(...args);\n      });\n    };\n\n    const staticWrappers = {\n      devtools: {\n        network: {\n          onRequestFinished: wrapEvent(onRequestFinishedWrappers),\n        },\n      },\n      runtime: {\n        onMessage: wrapEvent(onMessageWrappers),\n        onMessageExternal: wrapEvent(onMessageWrappers),\n        sendMessage: wrappedSendMessage.bind(null, \"sendMessage\", {minArgs: 1, maxArgs: 3}),\n      },\n      tabs: {\n        sendMessage: wrappedSendMessage.bind(null, \"sendMessage\", {minArgs: 2, maxArgs: 3}),\n      },\n    };\n    const settingMetadata = {\n      clear: {minArgs: 1, maxArgs: 1},\n      get: {minArgs: 1, maxArgs: 1},\n      set: {minArgs: 1, maxArgs: 1},\n    };\n    apiMetadata.privacy = {\n      network: {\"*\": settingMetadata},\n      services: {\"*\": settingMetadata},\n      websites: {\"*\": settingMetadata},\n    };\n\n    return wrapObject(extensionAPIs, staticWrappers, apiMetadata);\n  };\n\n  if (typeof chrome != \"object\" || !chrome || !chrome.runtime || !chrome.runtime.id) {\n    throw new Error(\"This script should only be loaded in a browser extension.\");\n  }\n\n  // The build process adds a UMD wrapper around this file, which makes the\n  // `module` variable available.\n  module.exports = wrapAPIs(chrome);\n} else {\n  module.exports = browser;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\nexports.browser = require(\"webextension-polyfill\");\n","const signals = [\"getImagesInSelection\", \"hotkeyTriggered\"] as const;\n\nexport function signal<T extends typeof signals[number]>(subject: T): {subject: T} {\n    return {subject};\n}\n\n//\n\nconst topics = {\n    afterHotkeyTriggered: \"afterHotkeyTriggered\",\n    downloadFinished: \"downloadFinished\",\n    downloadRequested: \"downloadRequested\",\n    downloadStarted: \"downloadStarted\"\n} as const;\n\nexport type DownloadChangedMessage = {subject: typeof topics.downloadStarted | typeof topics.downloadFinished; downloadId: number};\nexport function started(downloadId: number): DownloadChangedMessage {\n    return {\n        downloadId,\n        subject: topics.downloadStarted\n    };\n}\nexport function finished(downloadId: number): DownloadChangedMessage {\n    return {\n        downloadId,\n        subject: topics.downloadFinished\n    };\n}\n\ntype RequestedMessage = {subject: typeof topics.downloadRequested; imageUrl: string};\nexport function requestDownload(image: HTMLImageElement): RequestedMessage {\n    return {\n        imageUrl: image.src,\n        subject: topics.downloadRequested\n    };\n}\n\nexport type TriggeredMessage = {subject: typeof topics.afterHotkeyTriggered; imageFound: boolean};\nexport function hotkeyTriggered(imageFound: boolean): TriggeredMessage {\n    return {\n        imageFound,\n        subject: topics.afterHotkeyTriggered\n    };\n}\n\n//\n\nconst subjects = [...signals, ...Object.values(topics)] as string[];\n\nexport type Message = ReturnType<typeof signal> | DownloadChangedMessage | RequestedMessage | TriggeredMessage;\n\nfunction hasSubject(value: {subject?: unknown}): value is {subject: string} {\n    return typeof value.subject == \"string\";\n}\n\nfunction isMessage(value: unknown): value is Message {\n    return typeof value == \"object\" && value != null && hasSubject(value) && subjects.includes(value.subject);\n}\n\nexport function asMessage(value: unknown): Message {\n    if (isMessage(value)) {\n        return value;\n    } else {\n        throw new Error(`${JSON.stringify(value)} is not a message`);\n    }\n}\n","import { createComparator } from './comparator';\nimport { createCircularEqualCreator, sameValueZeroEqual } from './utils';\n\nexport { createComparator as createCustomEqual, sameValueZeroEqual };\n\nexport const deepEqual = createComparator();\nexport const shallowEqual = createComparator(() => sameValueZeroEqual);\n\nexport const circularDeepEqual = createComparator(createCircularEqualCreator());\nexport const circularShallowEqual = createComparator(\n  createCircularEqualCreator(sameValueZeroEqual),\n);\n","const HAS_WEAKSET_SUPPORT = typeof WeakSet === 'function';\n\nconst { keys } = Object;\n\ntype Cache = {\n  add: (value: any) => void;\n  has: (value: any) => boolean;\n};\n\nexport type EqualityComparator = (a: any, b: any, meta?: any) => boolean;\n\n/**\n * are the values passed strictly equal or both NaN\n *\n * @param a the value to compare against\n * @param b the value to test\n * @returns are the values equal by the SameValueZero principle\n */\nexport function sameValueZeroEqual(a: any, b: any) {\n  return a === b || (a !== a && b !== b);\n}\n\n/**\n * is the value a plain object\n *\n * @param value the value to test\n * @returns is the value a plain object\n */\nexport function isPlainObject(value: any) {\n  return value.constructor === Object || value.constructor == null;\n}\n\n/**\n * is the value promise-like (meaning it is thenable)\n *\n * @param value the value to test\n * @returns is the value promise-like\n */\nexport function isPromiseLike(value: any) {\n  return !!value && typeof value.then === 'function';\n}\n\n/**\n * is the value passed a react element\n *\n * @param value the value to test\n * @returns is the value a react element\n */\nexport function isReactElement(value: any) {\n  return !!(value && value.$$typeof);\n}\n\n/**\n * in cases where WeakSet is not supported, creates a new custom\n * object that mimics the necessary API aspects for cache purposes\n *\n * @returns the new cache object\n */\nexport function getNewCacheFallback(): Cache {\n  const values: any[] = [];\n\n  return {\n    add(value: any) {\n      values.push(value);\n    },\n\n    has(value: any) {\n      return values.indexOf(value) !== -1;\n    },\n  };\n}\n\n/**\n * get a new cache object to prevent circular references\n *\n * @returns the new cache object\n */\nexport const getNewCache = ((canUseWeakMap: boolean) => {\n  if (canUseWeakMap) {\n    return function _getNewCache(): Cache {\n      return new WeakSet();\n    };\n  }\n\n  return getNewCacheFallback;\n})(HAS_WEAKSET_SUPPORT);\n\n/**\n * create a custom isEqual handler specific to circular objects\n *\n * @param [isEqual] the isEqual comparator to use instead of isDeepEqual\n * @returns the method to create the `isEqual` function\n */\nexport function createCircularEqualCreator(isEqual?: EqualityComparator) {\n  return function createCircularEqual(comparator: EqualityComparator) {\n    const _comparator = isEqual || comparator;\n\n    return function circularEqual(\n      a: any,\n      b: any,\n      cache: Cache = getNewCache(),\n    ) {\n      const isCacheableA = !!a && typeof a === 'object';\n      const isCacheableB = !!b && typeof b === 'object';\n\n      if (isCacheableA || isCacheableB) {\n        const hasA = isCacheableA && cache.has(a);\n        const hasB = isCacheableB && cache.has(b);\n\n        if (hasA || hasB) {\n          return hasA && hasB;\n        }\n\n        if (isCacheableA) {\n          cache.add(a);\n        }\n\n        if (isCacheableB) {\n          cache.add(b);\n        }\n      }\n\n      return _comparator(a, b, cache);\n    };\n  };\n}\n\n/**\n * are the arrays equal in value\n *\n * @param a the array to test\n * @param b the array to test against\n * @param isEqual the comparator to determine equality\n * @param meta the meta object to pass through\n * @returns are the arrays equal\n */\nexport function areArraysEqual(\n  a: any[],\n  b: any[],\n  isEqual: EqualityComparator,\n  meta: any,\n) {\n  let index = a.length;\n\n  if (b.length !== index) {\n    return false;\n  }\n\n  while (index-- > 0) {\n    if (!isEqual(a[index], b[index], meta)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * are the maps equal in value\n *\n * @param a the map to test\n * @param b the map to test against\n * @param isEqual the comparator to determine equality\n * @param meta the meta map to pass through\n * @returns are the maps equal\n */\nexport function areMapsEqual(\n  a: Map<any, any>,\n  b: Map<any, any>,\n  isEqual: EqualityComparator,\n  meta: any,\n) {\n  let isValueEqual = a.size === b.size;\n\n  if (isValueEqual && a.size) {\n    a.forEach((aValue, aKey) => {\n      if (isValueEqual) {\n        isValueEqual = false;\n\n        b.forEach((bValue, bKey) => {\n          if (!isValueEqual && isEqual(aKey, bKey, meta)) {\n            isValueEqual = isEqual(aValue, bValue, meta);\n          }\n        });\n      }\n    });\n  }\n\n  return isValueEqual;\n}\n\ntype Dictionary<Type> = {\n  [key: string]: Type;\n  [index: number]: Type;\n};\n\nconst OWNER = '_owner';\n\nconst hasOwnProperty = Function.prototype.bind.call(\n  Function.prototype.call,\n  Object.prototype.hasOwnProperty,\n);\n\n/**\n * are the objects equal in value\n *\n * @param a the object to test\n * @param b the object to test against\n * @param isEqual the comparator to determine equality\n * @param meta the meta object to pass through\n * @returns are the objects equal\n */\nexport function areObjectsEqual(\n  a: Dictionary<any>,\n  b: Dictionary<any>,\n  isEqual: EqualityComparator,\n  meta: any,\n) {\n  const keysA = keys(a);\n\n  let index = keysA.length;\n\n  if (keys(b).length !== index) {\n    return false;\n  }\n\n  if (index) {\n    let key: string;\n\n    while (index-- > 0) {\n      key = keysA[index];\n\n      if (key === OWNER) {\n        const reactElementA = isReactElement(a);\n        const reactElementB = isReactElement(b);\n\n        if (\n          (reactElementA || reactElementB) &&\n          reactElementA !== reactElementB\n        ) {\n          return false;\n        }\n      }\n\n      if (!hasOwnProperty(b, key) || !isEqual(a[key], b[key], meta)) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\n/**\n * are the regExps equal in value\n *\n * @param a the regExp to test\n * @param b the regExp to test agains\n * @returns are the regExps equal\n */\nexport function areRegExpsEqual(a: RegExp, b: RegExp) {\n  return (\n    a.source === b.source &&\n    a.global === b.global &&\n    a.ignoreCase === b.ignoreCase &&\n    a.multiline === b.multiline &&\n    a.unicode === b.unicode &&\n    a.sticky === b.sticky &&\n    a.lastIndex === b.lastIndex\n  );\n}\n\n/**\n * are the sets equal in value\n *\n * @param a the set to test\n * @param b the set to test against\n * @param isEqual the comparator to determine equality\n * @param meta the meta set to pass through\n * @returns are the sets equal\n */\nexport function areSetsEqual(\n  a: Set<any>,\n  b: Set<any>,\n  isEqual: EqualityComparator,\n  meta: any,\n) {\n  let isValueEqual = a.size === b.size;\n\n  if (isValueEqual && a.size) {\n    a.forEach((aValue) => {\n      if (isValueEqual) {\n        isValueEqual = false;\n\n        b.forEach((bValue) => {\n          if (!isValueEqual) {\n            isValueEqual = isEqual(aValue, bValue, meta);\n          }\n        });\n      }\n    });\n  }\n\n  return isValueEqual;\n}\n","import {\n  EqualityComparator,\n  areArraysEqual,\n  areMapsEqual,\n  areObjectsEqual,\n  areRegExpsEqual,\n  areSetsEqual,\n  isPlainObject,\n  isPromiseLike,\n  sameValueZeroEqual,\n} from './utils';\n\nconst HAS_MAP_SUPPORT = typeof Map === 'function';\nconst HAS_SET_SUPPORT = typeof Set === 'function';\n\ntype EqualityComparatorCreator = (fn: EqualityComparator) => EqualityComparator;\n\nexport function createComparator(createIsEqual?: EqualityComparatorCreator) {\n  const isEqual: EqualityComparator =\n    /* eslint-disable no-use-before-define */\n    typeof createIsEqual === 'function'\n      ? createIsEqual(comparator)\n      : comparator;\n  /* eslint-enable */\n\n  /**\n   * compare the value of the two objects and return true if they are equivalent in values\n   *\n   * @param a the value to test against\n   * @param b the value to test\n   * @param [meta] an optional meta object that is passed through to all equality test calls\n   * @returns are a and b equivalent in value\n   */\n  function comparator(a: any, b: any, meta?: any) {\n    if (a === b) {\n      return true;\n    }\n\n    if (a && b && typeof a === 'object' && typeof b === 'object') {\n      if (isPlainObject(a) && isPlainObject(b)) {\n        return areObjectsEqual(a, b, isEqual, meta);\n      }\n\n      let aShape = Array.isArray(a);\n      let bShape = Array.isArray(b);\n\n      if (aShape || bShape) {\n        return aShape === bShape && areArraysEqual(a, b, isEqual, meta);\n      }\n\n      aShape = a instanceof Date;\n      bShape = b instanceof Date;\n\n      if (aShape || bShape) {\n        return (\n          aShape === bShape && sameValueZeroEqual(a.getTime(), b.getTime())\n        );\n      }\n\n      aShape = a instanceof RegExp;\n      bShape = b instanceof RegExp;\n\n      if (aShape || bShape) {\n        return aShape === bShape && areRegExpsEqual(a, b);\n      }\n\n      if (isPromiseLike(a) || isPromiseLike(b)) {\n        return a === b;\n      }\n\n      if (HAS_MAP_SUPPORT) {\n        aShape = a instanceof Map;\n        bShape = b instanceof Map;\n\n        if (aShape || bShape) {\n          return aShape === bShape && areMapsEqual(a, b, isEqual, meta);\n        }\n      }\n\n      if (HAS_SET_SUPPORT) {\n        aShape = a instanceof Set;\n        bShape = b instanceof Set;\n\n        if (aShape || bShape) {\n          return aShape === bShape && areSetsEqual(a, b, isEqual, meta);\n        }\n      }\n\n      return areObjectsEqual(a, b, isEqual, meta);\n    }\n\n    return a !== a && b !== b;\n  }\n\n  return comparator;\n}\n","import {Opaque} from \"type-fest\";\n\n// bar or foo or *\ntype Name = Opaque<string, \"name\">;\n// [bar, foo, *]\ntype Tail = Opaque<Name[], \"tail\">;\n// *.foo.bar.com -> tld=com, tail=[bar, foo, *]\ninterface DomainSpec {\n    tail: Tail;\n    tld: Name;\n}\n\nfunction fallsUnderName(name: Name, filter: Name): boolean {\n    return filter === name || filter === \"*\";\n}\n\nfunction fallsUnderTail(tail: Tail, filter: Tail): boolean {\n    if (filter.length !== tail.length) {\n        return false;\n    }\n\n    return Array(filter.length)\n        .fill(0)\n        .map((_, index) => index)\n        .every(i => fallsUnderName(tail[i]!, filter[i]!));\n}\n\nfunction toDomainFilter(domain: string): DomainSpec {\n    const [tld, ...tail] = domain.split(\".\").reverse();\n    return {\n        tail: tail as Tail,\n        tld: tld as Name\n    };\n}\n\nfunction getOrNew<K, V>(key: K, map: Map<K, Set<V>>): Set<V> {\n    const entry = map.get(key);\n    if (entry == null) {\n        const set = new Set<V>();\n        map.set(key, set);\n        return set;\n    } else {\n        return entry;\n    }\n}\n\nfunction matches(tree: Map<Name, Set<Tail>>, domain: string): boolean {\n    const target = toDomainFilter(domain);\n    const filtersForTld = tree.get(target.tld);\n\n    return filtersForTld == null ? false : Array.from(filtersForTld).some(filter => fallsUnderTail(target.tail, filter));\n}\n\nexport type DomainFilter = (domain: string) => boolean;\n\nexport function domainFilterFrom(domains: readonly string[]): DomainFilter {\n    const tree = new Map<Name, Set<Tail>>();\n\n    domains.map(toDomainFilter).forEach(filter => getOrNew(filter.tld, tree).add(filter.tail));\n\n    return (domain: string): boolean => matches(tree, domain);\n}\n\n// matches \"foo.*.bar\"\nexport const DOMAIN_NAME_FILTER_PATTERN = /^(?:(?:[\\w-]+|\\*)\\.)*(?:[\\w-]+|\\*)$/iu;\n","import {JsonValue} from \"type-fest\";\n\nexport function bool(def: boolean) {\n    return (input: unknown): boolean => (typeof input === \"boolean\" ? input : def);\n}\n\nexport function num(def: number, ...validators: ((i: number) => boolean)[]) {\n    return (input: unknown): number => (typeof input === \"number\" && validators.every(val => val(input)) ? input : def);\n}\n\nexport function str(def: string, ...validators: ((i: string) => boolean)[]) {\n    return (input: unknown): string => (typeof input === \"string\" && validators.every(val => val(input)) ? input : def);\n}\n\nexport function stringEnum<T extends string>(enumType: Record<string, T>, def: T) {\n    return (input: unknown): T => {\n        const isValid =\n            typeof input === \"string\" &&\n            Object.values(enumType)\n                .map(entry => entry as string)\n                .includes(input);\n        return isValid ? (input as T) : def;\n    };\n}\n\nexport function stringArray(def: string[], ...validators: ((x: string) => boolean)[]) {\n    return (input: unknown): string[] =>\n        Array.isArray(input) && input.every(entry => typeof entry === \"string\" && validators.every(validator => validator(entry))) ? (input as string[]) : def;\n}\n\nexport function roundedTo(decimals: number) {\n    return (input: number): boolean => {\n        const multiplied = input * 10 ** decimals;\n        return multiplied === Math.round(multiplied);\n    };\n}\n\nexport function matching(regex: RegExp) {\n    return (input: string): boolean => regex.test(input);\n}\n\nexport function notBlank(value: string): boolean {\n    return value.trim().length > 0;\n}\n\nexport function gt(min: number) {\n    return (input: number): boolean => input > min;\n}\n\nexport function gte(min: number) {\n    return (input: number): boolean => input >= min;\n}\n\nexport function lte(max: number) {\n    return (input: number): boolean => input <= max;\n}\n\nexport function sanitize<T, K extends keyof T = keyof T>(source: Record<K, JsonValue>, spec: Record<K, (x: unknown) => T[K]>): T {\n    const destination: Partial<T> = {};\n\n    for (const field of Object.getOwnPropertyNames(spec) as K[]) {\n        if (Object.prototype.hasOwnProperty.call(spec, field)) {\n            const validator = spec[field];\n            const sourceValue = source[field];\n\n            destination[field] = validator(sourceValue);\n        }\n    }\n\n    return destination as T;\n}\n","export enum ClickType {\n    none = \"none\",\n    singleLeft = \"singleLeft\",\n    doubleLeft = \"doubleLeft\",\n    singleRight = \"singleRight\",\n    doubleRight = \"doubleRight\"\n}\n\nexport enum HoverButtonPosition {\n    // corners\n    topLeftNE = \"1_2\",\n    topLeftSW = \"1_3\",\n    topLeftSE = \"1_4\",\n\n    topRightNW = \"2_1\",\n    topRightSW = \"2_3\",\n    topRightSE = \"2_4\",\n\n    bottomLeftNW = \"3_1\",\n    bottomleftNE = \"3_2\",\n    bottomLeftSE = \"3_4\",\n\n    bottomRightNW = \"4_1\",\n    bottomRightNE = \"4_2\",\n    bottomRightSW = \"4_3\",\n\n    // axis\n    northNorth = \"1\",\n    north = \"2\",\n    westWest = \"3\",\n    west = \"4\",\n    center = \"5\",\n    east = \"6\",\n    eastEast = \"7\",\n    south = \"8\",\n    southSouth = \"9\"\n}\n\nexport enum HoverButtonSkin {\n    original = \"original\",\n    alt1 = \"alt1\"\n}\n\nexport enum ConflictAction {\n    autoUnique = \"uniquify\",\n    // TODO firefox support\n    prompt = \"prompt\",\n    overwrite = \"overwrite\"\n}\n\n// *_DIRS = url path as nested dirs\n// *_PATH = url path as 1 dot-concatenated dir\nexport enum FilenameVariables {\n    tabDomain = \"%pagedomain%\",\n    tabDirs = \"%pagedirs%\",\n    tabPath = \"%pagepath%\",\n    tabTitle = \"%title%\",\n\n    imageDomain = \"%imagedomain%\",\n    imageDirs = \"%imagedirs%\",\n    imagePath = \"%imagepath%\",\n\n    counter = \"%counter%\",\n    inferred = \"%original%\",\n\n    year = \"%y%\",\n    month = \"%M%\",\n    day = \"%d%\",\n    hour = \"%h%\",\n    minute = \"%m%\",\n    second = \"%s%\",\n    millisecond = \"%ms%\"\n}\n","import {JsonValue} from \"type-fest\";\nimport {browser} from \"webextension-polyfill-ts\";\nimport {DOMAIN_NAME_FILTER_PATTERN} from \"../filtering\";\nimport {bool, gt, gte, lte, matching, notBlank, num, roundedTo, sanitize, str, stringArray, stringEnum} from \"./validation\";\nimport {ClickType, ConflictAction, FilenameVariables, HoverButtonPosition, HoverButtonSkin} from \"./enums\";\n\nconst spec = {\n    aggressiveCursorTracking: bool(false),\n    buttonOpacity: num(1, gte(0.1), lte(1), roundedTo(2)),\n    buttonPosition: stringEnum(HoverButtonPosition, HoverButtonPosition.topRightSW),\n    buttonSize: num(48, Number.isInteger, gte(8), lte(512)),\n    counterPadding: num(1, Number.isInteger, gte(0)),\n    counterStart: num(1, Number.isInteger, gte(0)),\n    counterStep: num(1, Number.isInteger, gte(0)),\n    doubleRightClickMillis: num(250, Number.isInteger, gt(0)),\n    enableImageContextMenu: bool(true),\n    enableRename: bool(false),\n    enableSelectionContextMenu: bool(true),\n    excludedPageDomains: stringArray([], matching(DOMAIN_NAME_FILTER_PATTERN)),\n    excludedSourceDomains: stringArray([], matching(DOMAIN_NAME_FILTER_PATTERN)),\n    fileNamePattern: str(FilenameVariables.inferred, notBlank),\n    greyOut: bool(true),\n    minimumImageSize: num(100, Number.isInteger, gte(1)),\n    notify: bool(false),\n    onFilenameConflict: stringEnum(ConflictAction, ConflictAction.autoUnique),\n    oneClickStyle: stringEnum(HoverButtonSkin, HoverButtonSkin.alt1),\n    pageDomainsAreWhitelist: bool(false),\n    persist: bool(false),\n    requireShift: bool(false),\n    singleClickEnabled: bool(false),\n    sourceDomainsAreWhitelist: bool(false),\n    supportDragDrop: bool(true),\n    triggerByClickType: stringEnum(ClickType, ClickType.doubleLeft)\n};\n\nexport type Settings = {\n    readonly [P in keyof typeof spec]: ReturnType<typeof spec[P]>;\n};\n\nexport function isSetting(key: string): key is keyof Settings {\n    return key in spec;\n}\n\nexport async function read(): Promise<Record<keyof Settings, JsonValue>> {\n    const json = await browser.storage.sync.get(Object.keys(spec));\n    return json as Record<keyof Settings, JsonValue>;\n}\n\nexport async function write(dto: Partial<Settings>): Promise<void> {\n    return browser.storage.sync.set(dto);\n}\n\nexport function correct(raw: Record<keyof Settings, JsonValue>): Settings {\n    return sanitize<Settings>(raw, spec);\n}\n","import {deepEqual} from \"fast-equals\";\nimport {correct, read, Settings, write} from \"./io\";\n\nexport async function load(): Promise<Settings> {\n    const raw = await read();\n    return correct(raw);\n}\n\nexport async function validate(): Promise<boolean> {\n    const raw = await read();\n    const validated = correct(raw);\n\n    if (deepEqual(validated, raw)) {\n        return true;\n    } else {\n        await write(validated);\n        return false;\n    }\n}\n\nexport function passesShiftKeySetting(event: MouseEvent, settings: Settings): boolean {\n    return !settings.requireShift || event.shiftKey;\n}\n\nexport function passesSizeRestrictions(image: HTMLImageElement, settings: Settings): boolean {\n    return image.width > settings.minimumImageSize && image.height > settings.minimumImageSize;\n}\n","import {Storage, browser} from \"webextension-polyfill-ts\";\nimport {load} from \"./settings\";\nimport {isSetting, Settings} from \"./io\";\n\ntype SettingListener = (settings: Settings) => void;\nconst callbacks = new Map<keyof Settings, SettingListener[]>();\n\nasync function triggerListeners(changes: (keyof Settings)[]): Promise<void> {\n    const settings = await load();\n\n    const cbs = changes.flatMap(property => callbacks.get(property) ?? []).map(cb => cb(settings));\n\n    await Promise.all(cbs);\n}\n\nfunction getOrSet<K, V>(map: Map<K, V>, key: K, fallback: V): V {\n    const existing = map.get(key);\n    if (existing == null) {\n        map.set(key, fallback);\n        return fallback;\n    } else {\n        return existing;\n    }\n}\n\nexport function monitor(setting: keyof Settings, listener: SettingListener): void {\n    getOrSet(callbacks, setting, []).push(listener);\n}\n\nasync function inspectChanges(changes: Record<string, Storage.StorageChange | undefined>, area: string): Promise<void> {\n    if (area === \"sync\") {\n        const keys = Object.keys(changes).flatMap(key => (isSetting(key) ? [key] : []));\n        await triggerListeners(keys);\n    }\n}\n\nexport function monitorStorage(): void {\n    browser.storage.onChanged.addListener((changes, area) => void inspectChanges(changes, area).catch(console.error));\n}\n","import {browser, Downloads, Events, Notifications} from \"webextension-polyfill-ts\";\n\ninterface FilenameSuggestion {\n    filename: string;\n    conflictAction: Downloads.FilenameConflictAction;\n}\n\n// return true sync if calling `suggest` async\n// https://developer.chrome.com/extensions/downloads#event-onDeterminingFilename\ntype DetermineFilename = (downloadItem: Downloads.DownloadItem, suggest: SuggestionCallback) => true | undefined;\ntype DeterminingFilenameEvent = Events.Event<DetermineFilename>;\n\nexport type SuggestionCallback = (suggestion?: FilenameSuggestion) => void;\n\n// TODO firefox support: https://bugzilla.mozilla.org/show_bug.cgi?id=1245652\nexport function fileNamingSupport(): DeterminingFilenameEvent | undefined {\n    return (\n        browser.downloads as {\n            onDeterminingFilename?: DeterminingFilenameEvent;\n        }\n    ).onDeterminingFilename;\n}\n\nexport interface AdvancedNotificationOptions {\n    type: \"image\";\n    imageUrl: string;\n    buttons: {title: string}[];\n}\n\n// TODO firefox support\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1213455\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1190681\n// https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/notifications/NotificationOptions#imageUrl\nexport async function tryCreateFancyNotification(\n    basicOptions: Notifications.CreateNotificationOptions,\n    advancedOptions: AdvancedNotificationOptions\n): Promise<string> {\n    try {\n        // this method throws an error immediately despite returning a promise\n        // eslint-disable-next-line @typescript-eslint/return-await\n        return browser.notifications.create({...basicOptions, ...advancedOptions});\n    } catch (probablyUnsupportedParams: unknown) {\n        // eslint-disable-next-line @typescript-eslint/return-await\n        return browser.notifications.create(basicOptions);\n    }\n}\n","import {Settings} from \"../common/settings/io\";\n\nexport type TabAndFrameId = [number, number | null];\n\n// download -> [tab, frame]\nexport const downloads = new Map<number, TabAndFrameId>();\n// notification -> download\nexport const notifications = new Map<string, number>();\n\n// requires persistent script\n// TODO move to local storage?\nlet counter = NaN;\nexport function tickCounter(settings: Settings): number {\n    if (isNaN(counter)) {\n        counter = settings.counterStart;\n    } else {\n        counter += settings.counterStep;\n    }\n    return counter;\n}\n","import {browser, Downloads, Notifications} from \"webextension-polyfill-ts\";\nimport {AdvancedNotificationOptions, tryCreateFancyNotification} from \"../common/compatibility\";\nimport {notifications} from \"./state\";\n\nasync function inspectDownload(notificationId: string, buttonIndex: number): Promise<void> {\n    const downloadId = notifications.get(notificationId);\n\n    if (downloadId == null) {\n        throw new Error(`missing download id for notification ${notificationId}`);\n    }\n\n    switch (buttonIndex) {\n        case 0:\n            return browser.downloads.open(downloadId);\n        case 1:\n            await browser.downloads.show(downloadId);\n            break;\n        default:\n            throw new Error(`unknown button: ${buttonIndex}`);\n    }\n}\n\nexport function monitorNotifications(): void {\n    browser.notifications.onButtonClicked.addListener((id, index) => void inspectDownload(id, index).catch(console.error));\n    browser.notifications.onClosed.addListener(id => notifications.delete(id));\n}\n\nconst iconUrl = \"images/icon-128.png\";\n\nexport async function notifyCompletion(downloadItem: Downloads.DownloadItem): Promise<void> {\n    const basicOptions: Notifications.CreateNotificationOptions = {\n        iconUrl,\n        message: downloadItem.filename,\n        title: \"Image downloaded\",\n        type: \"basic\"\n    };\n\n    const advancedOptions: AdvancedNotificationOptions = {\n        buttons: [\n            {\n                title: \"View image\"\n            },\n            {\n                title: \"Open folder\"\n            }\n        ],\n        imageUrl: downloadItem.filename,\n        type: \"image\"\n    };\n\n    const id = await tryCreateFancyNotification(basicOptions, advancedOptions);\n    notifications.set(id, downloadItem.id);\n}\n\nexport async function notifyNoImageForHotkey(): Promise<void> {\n    await browser.notifications.create({\n        iconUrl,\n        message: \"No image found under cursor.\",\n        title: \"Hotkey activated\",\n        type: \"basic\"\n    });\n}\n\nexport async function notifyFailure(download: Downloads.DownloadItem): Promise<void> {\n    const {os} = await browser.runtime.getPlatformInfo();\n    const separator = os === \"win\" ? \"\\\\\" : \"/\";\n    const filename = download.filename.slice(download.filename.lastIndexOf(separator) + 1);\n\n    await browser.notifications.create({\n        iconUrl: \"images/error-128.png\",\n        message: `Reason: ${download.error}\\nFile: ${filename}`,\n        title: \"Double-click download failed!\",\n        type: \"basic\"\n    });\n}\n","import {Tabs} from \"webextension-polyfill-ts\";\nimport {FilenameVariables} from \"./settings/enums\";\nimport {Settings} from \"./settings/io\";\n\nfunction pad(counter: number, counterPadding: number): string {\n    const nr = String(counter);\n    return \"0\".repeat(Math.max(0, counterPadding - nr.length)) + nr;\n}\n\nfunction separateExtension(filename: string): [string, string | null] {\n    const dotIndex = filename.lastIndexOf(\".\");\n\n    return dotIndex < 0 ? [filename, null] : [filename.substring(0, dotIndex), filename.substring(dotIndex + 1)];\n}\n\ninterface TechnicalContext {\n    counterPadding: number;\n    tabUrl: URL;\n    tabTitle: string;\n    imageUrl: URL;\n    counter: number;\n}\n\nexport function renameTechnically(filename: string, pattern: string, {counterPadding, tabUrl, tabTitle, imageUrl, counter}: TechnicalContext): string {\n    const [name, extension] = separateExtension(filename);\n    const now = new Date();\n\n    // replace in order of unlikeliness to accidentally create new %xyz% patterns, i.e. most predictable first\n    let newName = pattern;\n    const replace = (flag: FilenameVariables, value: string | number): void => {\n        newName = newName.replace(new RegExp(flag, \"gu\"), typeof value == \"string\" ? value : String(value));\n    };\n\n    replace(FilenameVariables.counter, pad(counter, counterPadding));\n\n    replace(FilenameVariables.year, now.getFullYear());\n    replace(FilenameVariables.month, pad(now.getMonth() + 1, 2));\n    replace(FilenameVariables.day, pad(now.getDate(), 2));\n    replace(FilenameVariables.hour, pad(now.getHours(), 2));\n    replace(FilenameVariables.minute, pad(now.getMinutes(), 2));\n    replace(FilenameVariables.second, pad(now.getSeconds(), 2));\n    replace(FilenameVariables.millisecond, pad(now.getMilliseconds(), 3));\n\n    replace(FilenameVariables.tabDomain, tabUrl.hostname);\n    replace(FilenameVariables.tabDirs, tabUrl.pathname.substring(1));\n    replace(FilenameVariables.tabPath, tabUrl.pathname.substring(1).replace(/\\//gu, \".\"));\n\n    replace(FilenameVariables.imageDomain, imageUrl.hostname);\n    replace(FilenameVariables.imageDirs, imageUrl.pathname.substring(1));\n    replace(FilenameVariables.imagePath, imageUrl.pathname.substring(1).replace(/\\//gu, \".\"));\n\n    // these last since they may contain % patterns\n    replace(FilenameVariables.inferred, name);\n    replace(FilenameVariables.tabTitle, tabTitle);\n\n    return extension == null ? newName : `${newName}.${extension}`;\n}\n\ninterface FunctionalContext {\n    settings: Settings;\n    tab: Tabs.Tab;\n    imageUrl: URL;\n}\n\nexport function renameFunctionally(filename: string, counter: (st: Settings) => number, {imageUrl, settings, tab}: FunctionalContext): string {\n    if (tab.url == null) {\n        throw new Error(\"missing url on tab?\");\n    }\n    const tabUrl = new URL(tab.url);\n    if (tab.title == null) {\n        throw new Error(\"missing title on tab?\");\n    }\n\n    return renameTechnically(filename, settings.fileNamePattern, {\n        counter: counter(settings),\n        counterPadding: settings.counterPadding,\n        imageUrl,\n        tabTitle: tab.title,\n        tabUrl\n    });\n}\n","import {Downloads, Tabs, browser} from \"webextension-polyfill-ts\";\nimport {finished} from \"../common/messages\";\nimport {notifyCompletion, notifyFailure} from \"./notifications\";\nimport {downloads, TabAndFrameId, tickCounter} from \"./state\";\nimport {SuggestionCallback, fileNamingSupport} from \"../common/compatibility\";\nimport {renameFunctionally} from \"../common/filename\";\nimport {load} from \"../common/settings/settings\";\n\nfunction indicateFinished(source: TabAndFrameId, delta: Downloads.OnChangedDownloadDeltaType): void {\n    const [tabId, frameId] = source;\n    downloads.delete(delta.id);\n    browser.tabs.sendMessage(tabId, finished(delta.id), {frameId: frameId ?? undefined}).catch(console.error);\n}\n\nasync function handleEndOfDownload(delta: Downloads.OnChangedDownloadDeltaType): Promise<void> {\n    const source = downloads.get(delta.id);\n    if (source == null) {\n        // not a download from this addon!\n        return;\n    }\n\n    const state = delta.state?.current as Downloads.State | null;\n\n    switch (state) {\n        case \"complete\": {\n            indicateFinished(source, delta);\n\n            const settings = await load();\n\n            if (settings.notify) {\n                const [downloadItem] = await browser.downloads.search({\n                    id: delta.id\n                });\n\n                return downloadItem == null ? undefined : notifyCompletion(downloadItem);\n            }\n\n            break;\n        }\n        case \"interrupted\": {\n            const [download] = await browser.downloads.search({\n                id: delta.id\n            });\n            if (download == null || download.error === \"USER_CANCELED\") {\n                indicateFinished(source, delta);\n            } else {\n                await notifyFailure(download);\n            }\n\n            break;\n        }\n        default:\n        // ignore\n    }\n}\n\nfunction determiningFilename(downloadItem: Downloads.DownloadItem, suggest: SuggestionCallback): true | undefined {\n    const downloadData = downloads.get(downloadItem.id);\n    if (downloadData == null) {\n        // not a download from this addon!\n        return;\n    }\n\n    load()\n        .then(async settings => {\n            if (settings.enableRename) {\n                const tab = await browser.tabs.get(downloadData[0]);\n                const filename = renameFunctionally(downloadItem.filename, tickCounter, {\n                    imageUrl: new URL(downloadItem.url),\n                    settings,\n                    tab\n                });\n\n                suggest({\n                    conflictAction: settings.onFilenameConflict,\n                    filename\n                });\n            } else {\n                suggest();\n            }\n        })\n        .catch((error: Error) => {\n            console.error(error);\n            suggest();\n        });\n\n    return true;\n}\n\nexport async function startDownload(img: URL, tab: Tabs.Tab, frameId: number | null): Promise<number> {\n    const settings = await load();\n    const downloadId = await browser.downloads.download({\n        conflictAction: settings.onFilenameConflict,\n        url: img.href\n    });\n\n    if (tab.id == null) {\n        throw new Error(\"tab without id?\");\n    }\n    downloads.set(downloadId, [tab.id, frameId]);\n\n    return downloadId;\n}\n\nexport function monitorDownloads(): void {\n    fileNamingSupport()?.addListener(determiningFilename);\n    browser.downloads.onChanged.addListener(delta => void handleEndOfDownload(delta).catch(console.error));\n}\n","import {noop} from \"ts-essentials\";\nimport {Menus, Tabs, browser} from \"webextension-polyfill-ts\";\nimport {signal} from \"../common/messages\";\nimport {Settings} from \"../common/settings/io\";\nimport {load} from \"../common/settings/settings\";\nimport {monitor} from \"../common/settings/monitoring\";\nimport {startDownload} from \"./downloads\";\n\nconst DOWNLOAD_IMAGE_ID = \"doubleClickImageDownloader_DownloadImage\";\nconst DOWNLOAD_SELECTED_IMAGES_ID = \"doubleClickImageDownloader_DownloadImagesInSelection\";\n\nasync function createContextMenu(options: Menus.CreateCreatePropertiesType): Promise<void> {\n    return new Promise((resolve, reject) => {\n        browser.contextMenus.create(options, (): void => {\n            if (browser.runtime.lastError == null) {\n                resolve();\n            } else {\n                reject(new Error(browser.runtime.lastError.message));\n            }\n        });\n    });\n}\n\nasync function downloadFocusedImage(contextMenuInfo: Menus.OnClickData, tab?: Tabs.Tab): Promise<void> {\n    if (tab == null) {\n        throw new Error(\"clicked outside a tab?\");\n    }\n    if (tab.id == null) {\n        throw new Error(\"missing tab id?\");\n    }\n\n    switch (contextMenuInfo.menuItemId) {\n        case DOWNLOAD_IMAGE_ID: {\n            if (contextMenuInfo.srcUrl == null) {\n                throw new Error(\"missing src on image\");\n            }\n\n            await startDownload(new URL(contextMenuInfo.srcUrl), tab, contextMenuInfo.frameId ?? null);\n\n            return;\n        }\n        case DOWNLOAD_SELECTED_IMAGES_ID: {\n            await browser.tabs.sendMessage(tab.id, signal(\"getImagesInSelection\"), {\n                frameId: contextMenuInfo.frameId\n            });\n\n            return;\n        }\n        default: {\n            throw new Error(`received context menu ${contextMenuInfo.menuItemId} and tab ${tab.id}?`);\n        }\n    }\n}\n\nasync function manageMenus(settings: Settings): Promise<void> {\n    await browser.contextMenus.remove(DOWNLOAD_IMAGE_ID).catch(noop);\n    await browser.contextMenus.remove(DOWNLOAD_SELECTED_IMAGES_ID).catch(noop);\n\n    if (settings.enableImageContextMenu) {\n        await createContextMenu({\n            contexts: [\"image\"],\n            documentUrlPatterns: [\"*://*/*\", \"file:///*\"],\n            id: DOWNLOAD_IMAGE_ID,\n            title: \"Download image\",\n            type: \"normal\"\n        });\n    }\n\n    if (settings.enableSelectionContextMenu) {\n        await createContextMenu({\n            contexts: [\"selection\"],\n            documentUrlPatterns: [\"*://*/*\", \"file:///*\"],\n            id: DOWNLOAD_SELECTED_IMAGES_ID,\n            title: \"Download images in selection\",\n            type: \"normal\"\n        });\n    }\n}\n\nexport function registerContextMenu(): void {\n    browser.contextMenus.onClicked.addListener((clicked, tab) => void downloadFocusedImage(clicked, tab).catch(console.error));\n\n    load().then(manageMenus).catch(console.error);\n\n    monitor(\"enableImageContextMenu\", settings => void manageMenus(settings).catch(console.error));\n    monitor(\"enableSelectionContextMenu\", settings => void manageMenus(settings).catch(console.error));\n}\n","import {Runtime, browser} from \"webextension-polyfill-ts\";\nimport {asMessage, Message, started, DownloadChangedMessage} from \"../common/messages\";\nimport {startDownload} from \"./downloads\";\n\nasync function reactToMessage(msg: Message, sender: Runtime.MessageSender): Promise<DownloadChangedMessage> {\n    switch (msg.subject) {\n        case \"downloadRequested\": {\n            if (sender.tab == null) {\n                throw new Error(\"starting a download headlessly?\");\n            }\n            const downloadId = await startDownload(new URL(msg.imageUrl), sender.tab, sender.frameId ?? null);\n            return started(downloadId);\n        }\n        default:\n            throw new Error(`unknown message: ${JSON.stringify(msg)}`);\n    }\n}\n\nexport function listenForMessages(): void {\n    browser.runtime.onMessage.addListener(async (data: unknown, sender) => reactToMessage(asMessage(data), sender));\n}\n","import {Runtime, browser} from \"webextension-polyfill-ts\";\nimport {validate} from \"../common/settings/settings\";\n\nasync function showOptions(details: Runtime.OnInstalledDetailsType): Promise<void> {\n    if (details.reason === \"install\" || details.reason === \"update\") {\n        const valid = await validate();\n        return valid ? undefined : browser.runtime.openOptionsPage();\n    }\n}\n\nexport function fixSettingsOnUpdate(): void {\n    browser.runtime.onInstalled.addListener(details => void showOptions(details).catch(console.error));\n}\n","import {browser} from \"webextension-polyfill-ts\";\nimport {asMessage, signal} from \"../common/messages\";\nimport {notifyNoImageForHotkey} from \"./notifications\";\n\nasync function downloadFocusedImage(): Promise<void> {\n    const [tab] = await browser.tabs.query({active: true, currentWindow: true});\n    if (tab?.id == null) {\n        throw new Error(\"missing tab id\");\n    }\n\n    const response = await browser.tabs.sendMessage(tab.id, signal(\"hotkeyTriggered\")).then(asMessage);\n\n    if (response.subject !== \"afterHotkeyTriggered\") {\n        throw new Error(`unexpected response ${JSON.stringify(response)}`);\n    }\n\n    if (!response.imageFound) {\n        await notifyNoImageForHotkey();\n    }\n}\n\nexport function monitorHotkey(): void {\n    browser.commands.onCommand.addListener(command => {\n        switch (command) {\n            case \"download-focused\":\n                downloadFocusedImage().catch(console.error);\n                break;\n            default:\n                throw new Error(`unknown hotkey command: ${command}`);\n        }\n    });\n}\n","import {registerContextMenu} from \"./background/context-menu\";\nimport {monitorDownloads} from \"./background/downloads\";\nimport {listenForMessages} from \"./background/messaging\";\nimport {monitorNotifications} from \"./background/notifications\";\nimport {fixSettingsOnUpdate} from \"./background/settings-validation\";\nimport {monitorHotkey} from \"./background/hotkey\";\nimport {monitorStorage} from \"./common/settings/monitoring\";\n\nmonitorStorage();\nfixSettingsOnUpdate();\nmonitorNotifications();\nmonitorDownloads();\nmonitorHotkey();\nlistenForMessages();\nregisterContextMenu();\n"]}